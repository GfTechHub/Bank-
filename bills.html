<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pay Bills</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    body {
      background-color: #0d1117;
      color: white;
    }
    .card {
      background-color: #161b22;
      border: none;
      border-radius: 12px;
    }
    .modal-content {
      background-color: #161b22;
      color: white;
      border-radius: 12px;
    }
    .form-label {
      font-weight: 600;
      color: #ddd;
    }
    .pin-input {
      letter-spacing: 0.5rem;
      font-size: 1.5rem;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container py-5">
    <!-- Back Button -->
    <a href="index.html" class="text-white text-decoration-none mb-3 d-inline-block">
      <i class="bi bi-arrow-left"></i> Back
    </a>

    <!-- Page Title -->
    <h4 class="fw-bold mb-3">Pay Bills</h4>

    <!-- Bills Form -->
    <div class="card p-4 shadow-sm">
      <form id="billsForm">
        <div class="mb-3">
          <label for="billType" class="form-label">Bill Type</label>
          <select class="form-select" id="billType" required>
            <option value="">Select Bill</option>
            <option value="Electricity">Electricity</option>
            <option value="Water">Water</option>
            <option value="Internet">Internet</option>
            <option value="Cable TV">Cable TV</option>
          </select>
        </div>
        <div class="mb-3">
          <label for="customerId" class="form-label">Customer ID / Account Number</label>
          <input type="text" class="form-control" id="customerId" placeholder="Enter account number" required>
        </div>
        <div class="mb-3">
          <label for="amount" class="form-label">Amount</label>
          <input type="number" class="form-control" id="amount" placeholder="Enter amount" required>
        </div>
        <button type="button" class="btn btn-primary w-100 fw-bold" id="payNowBtn">
          <i class="bi bi-wallet2"></i> Pay Now
        </button>
      </form>
    </div>
  </div>

  <!-- PIN Modal -->
  <div class="modal fade" id="pinModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content p-4">
        <h5 class="modal-title mb-3">Enter Transaction PIN</h5>
        <input type="password" maxlength="4" class="form-control pin-input mb-3" id="pinInput" placeholder="****">
        <button class="btn btn-success w-100" id="confirmPinBtn">Confirm</button>
      </div>
    </div>
  </div>

  <!-- Success Modal -->
  <div class="modal fade" id="successModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content p-4 text-center">
        <i class="bi bi-check-circle-fill text-success" style="font-size: 3rem;"></i>
        <h5 class="mt-3">Bill Payment Successful</h5>
        <p class="text-muted" id="successMessage"></p>
        <a href="index.html" class="btn btn-primary w-100">OK</a>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const payNowBtn = document.getElementById("payNowBtn");
      const pinModal = new bootstrap.Modal(document.getElementById("pinModal"));
      const confirmPinBtn = document.getElementById("confirmPinBtn");
      const pinInput = document.getElementById("pinInput");
      const successModal = new bootstrap.Modal(document.getElementById("successModal"));
      const successMessage = document.getElementById("successMessage");

      // Show PIN modal
      payNowBtn.addEventListener("click", () => {
        if (document.getElementById("billsForm").checkValidity()) {
          pinModal.show();
        } else {
          document.getElementById("billsForm").reportValidity();
        }
      });

      // Confirm PIN
      confirmPinBtn.addEventListener("click", () => {
        const pin = pinInput.value;
        const billType = document.getElementById("billType").value;
        const customerId = document.getElementById("customerId").value;
        const amount = parseFloat(document.getElementById("amount").value);

        if (pin === "1234") {
          pinModal.hide();

          // Deduct from balance
          let balance = parseFloat(localStorage.getItem("balance")) || 1000000.40;
          if (amount > balance) {
            alert("Insufficient funds!");
            return;
          }
          balance -= amount;
          localStorage.setItem("balance", balance.toFixed(2));

          // Save transaction for notifications
          const transactions = JSON.parse(localStorage.getItem("transactions")) || [];
          transactions.push({
            type: "Bill",
            details: `₦${amount.toLocaleString()} paid for ${billType} (ID: ${customerId})`,
            amount: amount
          });
          localStorage.setItem("transactions", JSON.stringify(transactions));

          // Show success modal
          setTimeout(() => {
            successMessage.textContent = `You paid ₦${amount.toLocaleString()} for ${billType} (ID: ${customerId}).`;
            successModal.show();
          }, 500);

          pinInput.value = "";
        } else {
          alert("Incorrect PIN. Please try again.");
          pinInput.value = "";
        }
      });
    });
  </script>
</body>
</html>